# –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω—è—Ç—Å—è **–ø—Ä—è–º–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö MySQL** –≤ –∫–æ–ª–æ–Ω–∫–∞—Ö —Ç–∏–ø–∞ `MEDIUMBLOB`.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ö–µ–º–µ

1. **ProductImage** —Ç–∞–±–ª–∏—Ü–∞:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `data MEDIUMBLOB` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–π—Ç–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

2. **Category** —Ç–∞–±–ª–∏—Ü–∞:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `imageData MEDIUMBLOB` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–π—Ç–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### API –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **`/api/admin/upload`** ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–∞–π–ª—ã
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ url, data (base64) }` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - **–ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î** ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ç–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É

2. **`/api/admin/image/[id]`** ‚Äî –û—Ç–¥–∞—á–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –ë–î
   - GET –∑–∞–ø—Ä–æ—Å —Å ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - URL –≤–∏–¥–∞: `/api/admin/image/abc-123-def`

3. **`/api/admin/products/full`** ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `images: [{ url, data }]`
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ `ProductImage` —Å –±–∞–π—Ç–∞–º–∏

4. **`/api/admin/categories`** ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `imageData: string (base64)`
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –∫–æ–ª–æ–Ω–∫—É `imageData`

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é

–ú–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞:
```
20260219102148_add_image_data_to_db
```

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∑–∞–Ω–æ–≤–æ:
```bash
npx prisma migrate dev
```

### 2. –ó–∞–≥—Ä—É–∑–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π `/admin-products-add`
2. –í–≤–µ–¥–∏ —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. –ü–µ—Ä–µ—Ç–∞—â–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∑–æ–Ω—É –∑–∞–≥—Ä—É–∑–∫–∏
4. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –ø—Ä–µ–≤—å—é

### 3. –°–æ—Ö—Ä–∞–Ω–∏ —Ç–æ–≤–∞—Ä

1. –ó–∞–ø–æ–ª–Ω–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
2. –ù–∞–∂–º–∏ "–°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä"
3. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î

---

## üìä –ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã

### ‚úÖ –ü–ª—é—Å—ã
- –í—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (–ë–î)
- –ù–µ –Ω—É–∂–Ω–æ –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Railway, Vercel, –ª—é–±–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ
- –ë—ç–∫–∞–ø—ã –ë–î –≤–∫–ª—é—á–∞—é—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### ‚ùå –ú–∏–Ω—É—Å—ã
- –ë–î —Ä–∞—Å—Ç—ë—Ç –±—ã—Å—Ç—Ä–µ–µ (–∫–∞—Ä—Ç–∏–Ω–∫–∏ —Ç—è–∂—ë–ª—ã–µ)
- –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- MEDIUMBLOB –º–∞–∫—Å–∏–º—É–º 16MB –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è

```typescript
// ProductImage —Ç–∞–±–ª–∏—Ü–∞
{
  id: string,
  productId: string,
  url: string,           // /api/admin/image/{id}
  data: Buffer | null,   // base64 –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∞–π—Ç—ã
  order: number,
  createdAt: DateTime
}
```

### –û—Ç–¥–∞—á–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

```
GET /api/admin/image/{id}
‚Üí 200 OK
‚Üí Content-Type: image/webp
‚Üí [binary data]
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- MySQL MEDIUMBLOB: –¥–æ 16MB –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ 5MB
- –§–æ—Ä–º–∞—Ç—ã: JPEG, PNG, WEBP, AVIF, GIF, SVG

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ (Railway Dashboard ‚Üí Logs)
3. –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (< 5MB?)

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

1. –û—Ç–∫—Ä–æ–π URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
2. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å –ë–î ‚Äî –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–ª–æ–Ω–∫–µ `data`

```sql
SELECT id, url, LENGTH(data) as size FROM ProductImage LIMIT 5;
```

### –û—à–∏–±–∫–∞ "Packet too large"

**–ü—Ä–æ–±–ª–µ–º–∞:** MySQL –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á—å `max_allowed_packet` –≤ MySQL:

```sql
SET GLOBAL max_allowed_packet = 67108864; -- 64MB
```

–ò–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ MySQL (`my.cnf`):
```ini
[mysqld]
max_allowed_packet = 64M
```

---

## üìà –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–°—Ç–∞—Ä—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Å—Ç–∞–ª–∏—Å—å –≤ `/public/ProductImages/`.

–ß—Ç–æ–±—ã –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏—Ö –≤ –ë–î:

1. –°–∫–∞–∂–∏ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –∏–∑ `/public/ProductImages/`
2. –ó–∞–≥—Ä—É–∑–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É –∑–∞–Ω–æ–≤–æ
3. –û–±–Ω–æ–≤–∏ —Ç–æ–≤–∞—Ä—ã

–ò–ª–∏ –Ω–∞–ø–∏—à–∏ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.

---

## üìù Changelog

**2026-02-19**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ë–î
- ‚úÖ API `/api/admin/upload` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç base64 –¥–∞–Ω–Ω—ã–µ
- ‚úÖ API `/api/admin/image/[id]` –æ—Ç–¥–∞—ë—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –ë–î
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ë–î
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –ë–î
